stages:
  - build
  - test
# - release
#  - deploy

build:
  image: node:9-alpine

  stage: build

  before_script:
    - npm install -g pm2 nodemon
    - ./bin/setup

  script: ./bin/build

test:
  image: node:9-alpine

  stage: test

  before_script:
    - npm install -g pm2 nodemon
    - ./bin/setup

  script: ./bin/test

# release:
#   image: docker:latest
#
#   stage: release
#
#   services:
#     - docker:dind
#
#   before_script:
#     - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" $CI_REGISTRY
#
#   script:
#     - docker build --pull -t "$CI_REGISTRY_IMAGE" .
#     - docker push "$CI_REGISTRY_IMAGE"    - eval $(ssh-agent -s)

# deploy:
#   image: alpine:latest
#
#   stage: deploy
#
#   before_script:
#     - apk update
#     - apk add openssh bash
#     - eval $(ssh-agent -s)
#     - mkdir -p ~/.ssh
#     - bash -c "ssh-add <(echo '$SSH_PRIVATE_KEY')"
#
#   script:
#     - ssh $USER@$HOST echo "deploy"
